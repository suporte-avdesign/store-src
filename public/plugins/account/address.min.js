jQuery(function(e){if("undefined"==typeof avd_config_address)return!1;e.blockUI.defaults.overlayCSS.cursor="default";var r={updateTimer:!1,dirtyInput:!1,xhr:!1,$address_form:e("form.address"),init:function(){e(document.body).bind("update_address",this.update_address),e(document.body).bind("init_address",this.init_address),this.$address_form.attr("novalidate","novalidate"),this.$address_form.on("submit",this.submit),this.$address_form.on("input validate change",".input-text, select, input:checkbox",this.validate_field),this.$address_form.on("update",this.trigger_update_address),"1"===avd_config_address.is_address&&e(document.body).trigger("init_address"),"yes"===avd_config_address.option_indicate_transport&&e("input#indicate_transport").change(this.toggle_indicate_transport).change()},toggle_indicate_transport:function(){e("div.indicate_transport").hide(),e(this).is(":checked")&&e("div.indicate_transport").slideDown()},init_address:function(){e(document.body).trigger("update_address")},maybe_input_changed:function(e){r.dirtyInput&&r.input_changed(e)},input_changed:function(e){r.dirtyInput=e.target},queue_update_address:function(e){if(9===(e.keyCode||e.which||0))return!0;r.dirtyInput=this,r.reset_update_address_timer()},trigger_update_address:function(){r.reset_update_address_timer(),r.dirtyInput=!1,e(document.body).trigger("update_address")},reset_update_address_timer:function(){clearTimeout(r.updateTimer)},is_valid_json:function(r){try{var s=e.parseJSON(r);return s&&"object"==typeof s}catch(e){return!1}},validate_field:function(r){var s=e(this),d=s.closest(".form-row"),t=d.is(".validate-required"),o=r.type;"input"===o&&d.removeClass("woocommerce-invalid woocommerce-invalid-required-field woocommerce-invalid-email woocommerce-validated"),"validate"!==o&&"change"!==o||t&&("checkbox"!==s.attr("type")||s.is(":checked")?""===s.val()&&d.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-required-field"):d.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-required-field"))},update_address:function(e,s){r.reset_update_address_timer(),r.updateTimer=setTimeout(r.update_address_action,"5",s)},update_address_action:function(s){if(r.xhr&&r.xhr.abort(),0!==e("form.address").length)avd_config_address.csrf_token,e("form.address").serialize()},submit:function(){r.reset_update_address_timer();var s=e(this);if(s.is(".processing"))return!1;!1!==s.triggerHandler("checkout_place_order")&&(s.addClass("processing"),1!==s.data()["blockUI.isBlocked"]&&s.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajaxSetup({dataFilter:function(e,s){if("json"!==s)return e;if(r.is_valid_json(e))return e;var d=e.match(/{"result.*}/);return null===d?console.log("Unable to fix malformed JSON"):r.is_valid_json(d[0])?(console.log("Fixed malformed JSON. Original:"),console.log(e),e=d[0]):console.log("Unable to fix malformed JSON"),e}}),e.ajax({type:"POST",url:avd_config_address.address_url,data:s.serialize(),dataType:"json",beforeSend:function(){console.log(this.data)},success:function(s){try{"success"===s.result?(r.$address_form.prepend('<div class="return-address">'+s.success+"</div>"),r.$address_form.removeClass("processing").unblock(),r.scroll_to_notices(),setTimeout(function(){e(".return-address").hide()},1e4)):"redirect"===s.result?(r.$address_form.prepend('<div class="return-address">'+s.message+"</div>"),r.$address_form.removeClass("processing").unblock(),r.scroll_to_notices(),setTimeout(function(){-1===s.redirect.indexOf("https://")||-1===s.redirect.indexOf("http://")?window.location=s.redirect:window.location=decodeURI(s.redirect)},6e3)):(r.$address_form.prepend('<div class="return-address">'+s.message+"</div>"),r.$address_form.removeClass("processing").unblock(),r.scroll_to_notices(),setTimeout(function(){e(".return-address").hide()},1e4))}catch(d){if(!0===s.reload)return void window.location.reload();!0===s.refresh&&e(document.body).trigger("update_address"),s.message?r.submit_error(s.message):r.submit_error('<div class="woocommerce-error">'+avd_config_address.i18n_address_error+"</div>")}},error:function(s){if(422==s.status){var d=e.parseJSON(s.responseText),t="";e.each(d,function(r,s){"errors"==r&&e.each(d[r],function(e,r){t+="<li>"+r+"</li>"})})}r.submit_error('<ul class="woocommerce-error">'+t+"</ul>"),setTimeout(function(){e(".return-address").hide()},8e3)}}));return!1},submit_error:function(s){e(".return-address, .woocommerce-error, .woocommerce-message").remove(),r.$address_form.prepend('<div class="return-address">'+s+"</div>"),r.$address_form.removeClass("processing").unblock(),r.$address_form.find(".input-text, select, input:checkbox").trigger("validate").blur(),r.scroll_to_notices(),e(document.body).trigger("address_error")},scroll_to_notices:function(){var r=e(".return-address");r.length||(r=e(".form.address")),e.scroll_to_notices(r)}};r.init()});
