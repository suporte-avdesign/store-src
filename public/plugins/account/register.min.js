jQuery(function(e){if("undefined"==typeof avd_config_register)return!1;e.blockUI.defaults.overlayCSS.cursor="default";var r={updateTimer:!1,dirtyInput:!1,xhr:!1,$register_form:e("form.register"),init:function(){e(document.body).bind("update_register",this.update_register),e(document.body).bind("init_register",this.init_register),this.$register_form.attr("novalidate","novalidate"),this.$register_form.on("submit",this.submit),this.$register_form.on("input validate change",".input-text, select, input:checkbox",this.validate_field),this.$register_form.on("update",this.trigger_update_register),"1"===avd_config_register.is_register&&e(document.body).trigger("init_register"),"yes"===avd_config_register.option_indicate_transport&&e("input#indicate_transport").change(this.toggle_indicate_transport).change()},toggle_indicate_transport:function(){e("div.indicate_transport").hide(),e(this).is(":checked")&&(e("#transport_nome").val("").change(),e("#transport_phone").val("").change(),e("div.indicate_transport").slideDown())},init_register:function(){e(document.body).trigger("update_register")},maybe_input_changed:function(e){r.dirtyInput&&r.input_changed(e)},input_changed:function(e){r.dirtyInput=e.target},queue_update_register:function(e){if(9===(e.keyCode||e.which||0))return!0;r.dirtyInput=this,r.reset_update_register_timer()},trigger_update_register:function(){r.reset_update_register_timer(),r.dirtyInput=!1,e(document.body).trigger("update_register")},reset_update_register_timer:function(){clearTimeout(r.updateTimer)},is_valid_json:function(r){try{var i=e.parseJSON(r);return i&&"object"==typeof i}catch(e){return!1}},validate_field:function(r){var i=e(this),t=i.closest(".form-row"),o=!0,n=t.is(".validate-required"),s=t.is(".validate-email"),a=r.type;if("input"===a&&t.removeClass("woocommerce-invalid woocommerce-invalid-required-field woocommerce-invalid-email woocommerce-validated"),"validate"===a||"change"===a){if(n&&("checkbox"!==i.attr("type")||i.is(":checked")?""===i.val()&&(t.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-required-field"),o=!1):(t.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-required-field"),o=!1)),s)if(i.val())new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i).test(i.val())||(t.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-email"),o=!1);o&&t.removeClass("woocommerce-invalid woocommerce-invalid-required-field woocommerce-invalid-email").addClass("woocommerce-validated")}},update_register:function(e,i){r.reset_update_register_timer(),r.updateTimer=setTimeout(r.update_register_action,"5",i)},update_register_action:function(i){if(r.xhr&&r.xhr.abort(),0!==e("form.register").length)avd_config_register.csrf_token,e("form.register").serialize()},submit:function(){r.reset_update_register_timer();var i=e(this);if(i.is(".processing"))return!1;!1!==i.triggerHandler("checkout_place_order")&&(i.addClass("processing"),1!==i.data()["blockUI.isBlocked"]&&i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajaxSetup({dataFilter:function(e,i){if("json"!==i)return e;if(r.is_valid_json(e))return e;var t=e.match(/{"result.*}/);return null===t?console.log("Unable to fix malformed JSON"):r.is_valid_json(t[0])?(console.log("Fixed malformed JSON. Original:"),console.log(e),e=t[0]):console.log("Unable to fix malformed JSON"),e}}),e.ajax({type:"POST",url:avd_config_register.register_url,data:i.serialize(),dataType:"json",beforeSend:function(){console.log(this.data)},success:function(i){try{if("success"===i.result)r.$register_form.html('<div class="return-register">'+i.success+"</div>");else if("redirect"===i.result)-1===i.redirect.indexOf("https://")||-1===i.redirect.indexOf("http://")?window.location=i.redirect:window.location=decodeURI(i.redirect);else{if("failure"!==i.result)throw avd_config_register.error_json;r.submit_error(i.message)}}catch(t){if(!0===i.reload)return void window.location.reload();!0===i.refresh&&e(document.body).trigger("update_register"),i.message?r.submit_error(i.message):r.submit_error('<div class="woocommerce-error">'+avd_config_register.i18n_register_error+"</div>")}},error:function(i){if(422==i.status){var t=e.parseJSON(i.responseText),o="";e.each(t,function(r,i){"errors"==r&&e.each(t[r],function(e,r){o+="<li>"+r+"</li>"})})}r.submit_error('<ul class="woocommerce-error">'+o+"</ul>"),setTimeout(function(){e(".return-register").hide()},8e3)}}));return!1},submit_error:function(i){e(".return-register, .woocommerce-error, .woocommerce-message").remove(),r.$register_form.prepend('<div class="return-register">'+i+"</div>"),r.$register_form.removeClass("processing").unblock(),r.$register_form.find(".input-text, select, input:checkbox").trigger("validate").blur(),r.scroll_to_notices(),e(document.body).trigger("register_error")},scroll_to_notices:function(){var r=e(".return-register");r.length||(r=e(".form.register")),e.scroll_to_notices(r)}},i={init:function(){e(document.body).on("click","a.woocommerce-terms-and-conditions-link",this.toggle_terms)},toggle_terms:function(){if(e(".woocommerce-terms-and-conditions").length)return e(".woocommerce-terms-and-conditions").slideToggle(function(){var r=e(".woocommerce-terms-and-conditions-link");e(".woocommerce-terms-and-conditions").is(":visible")?(r.addClass("woocommerce-terms-and-conditions-link--open"),r.removeClass("woocommerce-terms-and-conditions-link--closed")):(r.removeClass("woocommerce-terms-and-conditions-link--open"),r.addClass("woocommerce-terms-and-conditions-link--closed"))}),!1}};r.init(),i.init()});
