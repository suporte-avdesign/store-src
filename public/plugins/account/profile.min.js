jQuery(function(e){if("undefined"==typeof avd_config_profile)return!1;e.blockUI.defaults.overlayCSS.cursor="default";var o={updateTimer:!1,dirtyInput:!1,xhr:!1,$profile_form:e("form.profile"),init:function(){e(document.body).bind("update_profile",this.update_profile),e(document.body).bind("init_profile",this.init_profile),this.$profile_form.attr("novalidate","novalidate"),this.$profile_form.on("submit",this.submit),this.$profile_form.on("input validate change",".input-text, select, input:checkbox",this.validate_field),this.$profile_form.on("update",this.trigger_update_profile),"1"===avd_config_profile.is_profile&&e(document.body).trigger("init_profile"),"yes"===avd_config_profile.option_change_password&&e("input#account_password_current").change(this.toggle_change_password).change()},toggle_change_password:function(){""!=e("#account_password_current").val()?(e("#validate_password").addClass("validate-required"),e("#validate_confirm").addClass("validate-required")):(e("#validate_password").removeClass("validate-required"),e("#validate_confirm").removeClass("validate-required"))},init_profile:function(){e(document.body).trigger("update_profile")},maybe_input_changed:function(e){o.dirtyInput&&o.input_changed(e)},input_changed:function(e){o.dirtyInput=e.target},queue_update_profile:function(e){if(9===(e.keyCode||e.which||0))return!0;o.dirtyInput=this,o.reset_update_profile_timer()},trigger_update_profile:function(){o.reset_update_profile_timer(),o.dirtyInput=!1,e(document.body).trigger("update_profile")},reset_update_profile_timer:function(){clearTimeout(o.updateTimer)},is_valid_json:function(o){try{var r=e.parseJSON(o);return r&&"object"==typeof r}catch(e){return!1}},validate_field:function(o){var r=e(this),i=r.closest(".form-row"),t=!0,a=i.is(".validate-required"),u=i.is(".validate-email"),l=o.type;if("input"===l&&i.removeClass("woocommerce-invalid woocommerce-invalid-required-field woocommerce-invalid-email woocommerce-validated"),"validate"===l||"change"===l){if(a&&("checkbox"!==r.attr("type")||r.is(":checked")?""===r.val()&&(i.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-required-field"),t=!1):(i.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-required-field"),t=!1)),u)if(r.val())new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i).test(r.val())||(i.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-email"),t=!1);t&&i.removeClass("woocommerce-invalid woocommerce-invalid-required-field woocommerce-invalid-email").addClass("woocommerce-validated")}},update_profile:function(e,r){o.reset_update_profile_timer(),o.updateTimer=setTimeout(o.update_profile_action,"5",r)},update_profile_action:function(r){if(o.xhr&&o.xhr.abort(),0!==e("form.profile").length)avd_config_profile.csrf_token,e("form.profile").serialize()},submit:function(){o.reset_update_profile_timer();var r=e(this);if(r.is(".processing"))return!1;!1!==r.triggerHandler("checkout_place_order")&&(r.addClass("processing"),1!==r.data()["blockUI.isBlocked"]&&r.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajaxSetup({dataFilter:function(e,r){if("json"!==r)return e;if(o.is_valid_json(e))return e;var i=e.match(/{"result.*}/);return null===i?console.log("Unable to fix malformed JSON"):o.is_valid_json(i[0])?(console.log("Fixed malformed JSON. Original:"),console.log(e),e=i[0]):console.log("Unable to fix malformed JSON"),e}}),e.ajax({type:"POST",url:avd_config_profile.profile_url,data:r.serialize(),dataType:"json",beforeSend:function(){console.log(this.data)},success:function(r){try{"success"===r.result?(e("#new_password").val(""),e("#reg_password_confirm").val(""),e("#account_password_current").val(""),o.$profile_form.prepend('<div class="return-profile">'+r.success+"</div>"),o.$profile_form.removeClass("processing").unblock(),o.scroll_to_notices(),setTimeout(function(){e(".return-profile").hide()},1e4)):"redirect"===r.result?(o.$profile_form.prepend('<div class="return-profile">'+r.message+"</div>"),o.$profile_form.removeClass("processing").unblock(),o.scroll_to_notices(),setTimeout(function(){-1===r.redirect.indexOf("https://")||-1===r.redirect.indexOf("http://")?window.location=r.redirect:window.location=decodeURI(r.redirect)},6e3)):(o.$profile_form.prepend('<div class="return-profile">'+r.message+"</div>"),o.$profile_form.removeClass("processing").unblock(),o.scroll_to_notices(),setTimeout(function(){e(".return-profile").hide()},1e4))}catch(i){if(!0===r.reload)return void window.location.reload();!0===r.refresh&&e(document.body).trigger("update_profile"),r.message?o.submit_error(r.message):o.submit_error('<div class="woocommerce-error">'+avd_config_profile.i18n_profile_error+"</div>")}},error:function(r){if(422==r.status){var i=e.parseJSON(r.responseText),t="";e.each(i,function(o,r){"errors"==o&&e.each(i[o],function(e,o){t+="<li>"+o+"</li>"})})}o.submit_error('<ul class="woocommerce-error">'+t+"</ul>"),setTimeout(function(){e(".return-profile").hide()},8e3)}}));return!1},submit_error:function(r){e(".return-profile, .woocommerce-error, .woocommerce-message").remove(),o.$profile_form.prepend('<div class="return-profile">'+r+"</div>"),o.$profile_form.removeClass("processing").unblock(),o.$profile_form.find(".input-text, select, input:checkbox").trigger("validate").blur(),o.scroll_to_notices(),e(document.body).trigger("profile_error")},scroll_to_notices:function(){var o=e(".return-profile");o.length||(o=e(".form.profile")),e.scroll_to_notices(o)}};o.init()});
