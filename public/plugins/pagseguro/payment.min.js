!function(e){e(".btn-payment-card").click(function(){var e=_pagSeguroSettings.btn_card,t=_pagSeguroSettings.class_card;return createCredCardToken(e,t),!1}),setSessionCreditId=function(){var t=e("#form-pagseguro").serialize(),n=_pagSeguroSettings.btn_card,r=_pagSeguroSettings.class_card;e.ajax({url:_pagSeguroSettings.ajax_transparente,method:"POST",data:t}).done(function(e){console.log(e),PagSeguroDirectPayment.setSessionId(e),getBrand(n,r)}).fail(function(e){console.log(e),errorPayment(n,r,_pagSeguroSettings.error_session)}).always(function(){})},getBrand=function(t,n){PagSeguroDirectPayment.getBrand({cardBin:e("input[name=cardNumber]").val().replace(/ /g,""),success:function(r){e("input[name=brandName]").val(r.brand.name),getInstallments(r.brand.name,t,n);var a=e("#"+r.brand.name).attr("src");e("#img_brand").html('<img src="'+a+'" alt="'+r.brand.name+'"/>')},error:function(r){e("#img_brand").html(""),errorPayment(t,n,_pagSeguroSettings.error_card_number)},complete:function(e){}})},getInstallments=function(t,n,r){var a=" "+_pagSeguroSettings.interest_true,o=" "+_pagSeguroSettings.interest_false,s=_pagSeguroSettings.currency_x+" ",i="";PagSeguroDirectPayment.getInstallments({amount:e("input[name=amount]").val(),maxInstallmentNoInterest:e("input[name=maxInstallment]").val(),brand:t,success:function(n){var r=n.installments[t];if(console.log(r),r.length>0){e("#label1").text(_pagSeguroSettings.select_installments);var l=[];e.each(r,function(e,t){var n=t.totalAmount.toFixed(2),r=t.installmentAmount.toFixed(2);i=0===e?t.quantity+s+n.replace(".",",")+a:1==t.interestFree?t.quantity+s+r.replace(".",",")+a:t.quantity+s+r.replace(".",",")+o,l.push({id:t.quantity+"|"+t.installmentAmount,text:i})}),e(".select-installments").select2({data:l})}},error:function(e){errorPayment(n,r,_pagSeguroSettings.error_method)},complete:function(e){}})},createCredCardToken=function(t,n){var r=e("input[name=cardCVV]").val(),a=e("#cardExpiryMonth option:selected").val(),o=e("#cardExpiryYear option:selected").val();PagSeguroDirectPayment.createCardToken({cardNumber:e("input[name=cardNumber]").val().replace(/ /g,""),brand:e("input[name=brandName]").val(),cvv:r,expirationMonth:a,expirationYear:o,success:function(r){e("input[name=cardToken]").val(r.card.token),createTransactionCard(t,n)},error:function(e){console.log(e),errorPayment(t,n,_pagSeguroSettings.error_card_token)},complete:function(e){console.log(e)}})},createTransactionCard=function(t,n){var r=PagSeguroDirectPayment.getSenderHash();e("#senderHash").val(r);var a=e("#form-pagseguro").serialize();e.ajax({url:_pagSeguroSettings.ajax_transaction,method:"POST",data:a,beforeSend:startPreloaderPS(n)}).done(function(e){stopPreloaderPS(t,n),1==e.success?window.location=e.redirect:errorPayment(t,n,_pagSeguroSettings.text_error)}).fail(function(r){if(stopPreloaderPS(t,n),422==r.status){var a=e.parseJSON(r.responseText),o="";e.each(a,function(t,n){"errors"==t&&e.each(a[t],function(e,t){o+="<li>"+t+"</li>"})})}e("#return-payment").show(),e("#return-payment").html('<ul class="woocommerce-error">'+o+"</ul>"),setTimeout(function(){e("#return-payment").hide()},6e3)}).always(function(){stopPreloaderPS(t,n)})},e(".btn-payment-billet").click(function(){return setSessionBilletId(),!1}),setSessionBilletId=function(){var t=e("#form-pagseguro").serialize(),n=_pagSeguroSettings.btn_billet,r=_pagSeguroSettings.class_billet;e.ajax({url:_pagSeguroSettings.ajax_transparente,method:"POST",data:t,beforeSend:startPreloaderPS(r)}).done(function(e){PagSeguroDirectPayment.setSessionId(e),paymentBillet(n,r)}).fail(function(){errorPayment(n,r,_pagSeguroSettings.error_session)}).always(function(){})},paymentBillet=function(t,n){var r=PagSeguroDirectPayment.getSenderHash();e("#senderHash").val(r);var a=e("#form-pagseguro").serialize();e.ajax({url:_pagSeguroSettings.ajax_billet,method:"POST",data:a}).done(function(e){1==e.success?window.location=e.redirect:errorPayment(t,n,_pagSeguroSettings.text_error)}).fail(function(){errorPayment(t,n,_pagSeguroSettings.text_error)}).always(function(){stopPreloaderPS(t,n)})},errorPayment=function(t,n,r){stopPreloaderPS(t,n),e("#return-payment").show(),e("#return-payment").html('<ul class="woocommerce-error"><li>'+r+"</li></ul>"),setTimeout(function(){e("#return-payment").hide()},6e3)},startPreloaderPS=function(t){e(t).attr("disabled",!0).addClass(_pagSeguroSettings.class_loading).text(_pagSeguroSettings.text_loading)},stopPreloaderPS=function(t,n){e(n).attr("disabled",!1).removeClass(_pagSeguroSettings.class_loading).text(t)},getPaymentMethods=function(){startPreloaderPS(),PagSeguroDirectPayment.getPaymentMethods({success:function(t){console.log(t),0==t.error&&e.each(t.paymentMethods,function(t,n){e(".payment-methods").append(t+"<br>")})},error:function(e){console.log(e),stopPreloaderPS()},complete:function(e){console.log(e)}})}}(window.jQuery);
