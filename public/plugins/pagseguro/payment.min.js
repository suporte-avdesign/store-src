!function(e){e(".select--epiry-month").select2({placeholder:"Mês",allowClear:!1}),e(".select--epiry-year").select2({placeholder:"Ano",allowClear:!1}),e(".select-installments").select2({placeholder:"Parcelamento",allowClear:!1});var t;e("#cardNumber").keyup(function(){clearTimeout(t),e("#cardNumber").val&&(t=setTimeout(setSessionCreditId,3e3))}),e(".other_holder").click(function(){e("#card-holder").toggle("show")}),e(".btn-payment-card").click(function(){if(0==validateCard()){var e=_pagSeguroSettings.btn_card,t=_pagSeguroSettings.class_card;createCredCardToken(e,t)}return!1}),setSessionCreditId=function(t,a){var n=e("#form-pagseguro").serialize();e.ajax({url:_pagSeguroSettings.ajax_transparente,method:"POST",data:n}).done(function(e){console.log(e),PagSeguroDirectPayment.setSessionId(e),getBrand()}).fail(function(){console.log(_pagSeguroSettings.text_error)}).always(function(){})},getBrand=function(){PagSeguroDirectPayment.getBrand({cardBin:e("input[name=cardNumber]").val().replace(/ /g,""),success:function(t){e("input[name=brandName]").val(t.brand.name),getInstallments(t.brand.name)},error:function(e){console.log(e)},complete:function(e){}})},getInstallments=function(t){var a=" "+_pagSeguroSettings+interest_true,n=" "+_pagSeguroSettings+interest_false,r=_pagSeguroSettings+currency_x+" ",o="";PagSeguroDirectPayment.getInstallments({amount:e("input[name=amount]").val(),maxInstallmentNoInterest:e("input[name=maxInstallment]").val(),brand:t,success:function(l){var i=l.installments[t];if(console.log(i),i.length>0){var s=[];e.each(i,function(e,t){o=0===e?t.quantity+r+t.totalAmount+a:1==t.interestFree?t.quantity+r+t.installmentAmount+a:t.quantity+r+t.installmentAmount+n,s.push({id:t.quantity+"|"+t.installmentAmount,text:o})}),e(".select-installments").select2({data:s})}},error:function(e){contole.log(e)},complete:function(e){}})},createCredCardToken=function(t,a){var n=e("input[name=cardCVV]").val(),r=e("#cardExpiryMonth option:selected").val(),o=e("#cardExpiryYear option:selected").val();PagSeguroDirectPayment.createCardToken({cardNumber:e("input[name=cardNumber]").val().replace(/ /g,""),brand:e("input[name=brandName]").val(),cvv:n,expirationMonth:r,expirationYear:o,success:function(n){e("input[name=cardToken]").val(n.card.token),createTransactionCard(t,a)},error:function(e){console.log(e),stopPreloaderPS(t,a)},complete:function(e){}})},createTransactionCard=function(t,a){var n=PagSeguroDirectPayment.getSenderHash();e("#senderHash").val(n);var r=e("#form-pagseguro").serialize();e.ajax({url:_pagSeguroSettings.ajax_transaction,method:"POST",data:r,beforeSend:startPreloaderPS(a)}).done(function(t){e("#return-payment").html("Seu pagamento foi realizado com sucesso! Código da Transação: "+t)}).fail(function(e){console.log(e.responseJSON.message),stopPreloaderPS(t,a)}).always(function(){})},validateCard=function(){var t=0,a="",n=e("input[name=cardNumber]").val(),r=e("input[name=cardName]").val(),o=e("input[name=cardCVV]").val();return n.length<19&&(t=1,e("input[name=cardNumber]").css("border","red solid 1px"),a="<li>"+_pagSeguroSettings.required_number+"</li>"),r.length<6&&(t=1,e("input[name=cardName]").css("border","red solid 1px"),a+="<li>"+_pagSeguroSettings.required_name+"</li>"),o.length<3&&(t=1,e("input[name=cardCVV]").css("border","red solid 1px"),a+="<li>"+_pagSeguroSettings.required_cvv+"</li>"),0==t?(e("input[name=cardNumber]").css("border","rgba(136, 135, 135, 0.25) solid 1px"),e("input[name=cardName]").css("border","rgba(136, 135, 135, 0.25) solid 1px"),e("input[name=cardCVV]").css("border","rgba(136, 135, 135, 0.25) solid 1px")):(e("#return-payment").show(),e("#return-payment").html('<ul class="woocommerce-error" role="alert">'+a+"</ul>"),setTimeout(function(){e("#return-payment").hide()},5e3)),t},e(".btn-payment-billet").click(function(){return setSessionBilletId(),!1}),setSessionBilletId=function(){var t=e("#form-pagseguro").serialize(),a=_pagSeguroSettings.btn_billet,n=_pagSeguroSettings.class_billet;e.ajax({url:_pagSeguroSettings.ajax_transparente,method:"POST",data:t,beforeSend:startPreloaderPS(n)}).done(function(e){PagSeguroDirectPayment.setSessionId(e),paymentBillet(a,n)}).fail(function(){stopPreloaderPS(a,n)}).always(function(){})},paymentBillet=function(t,a){var n=PagSeguroDirectPayment.getSenderHash();e("#senderHash").val(n);var r=e("#form-pagseguro").serialize();e.ajax({url:_pagSeguroSettings.ajax_billet,method:"POST",data:r}).done(function(e){e.success&&(window.location=e.redirect)}).fail(function(){console.log(_pagSeguroSettings.text_error),stopPreloaderPS(t,a)}).always(function(){stopPreloaderPS(t,a)})},startPreloaderPS=function(t){e(t).attr("disabled",!0).addClass(_pagSeguroSettings.class_loading).text(_pagSeguroSettings.text_loading)},stopPreloaderPS=function(t,a){e(a).attr("disabled",!1).removeClass(_pagSeguroSettings.class_loading).text(t)},getPaymentMethods=function(){startPreloaderPS(),PagSeguroDirectPayment.getPaymentMethods({success:function(t){console.log(t),0==t.error&&e.each(t.paymentMethods,function(t,a){e(".payment-methods").append(t+"<br>")})},error:function(e){console.log(e),stopPreloaderPS()},complete:function(e){console.log(e)}})}}(window.jQuery);
