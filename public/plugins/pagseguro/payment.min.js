!function(e){e(".btn-payment-card").click(function(){var e=_pagSeguroSettings.btn_card,t=_pagSeguroSettings.class_card;return createCredCardToken(e,t),!1}),setSessionCreditId=function(){var t=e("#form-pagseguro").serialize(),r=_pagSeguroSettings.btn_card,n=_pagSeguroSettings.class_card;e.ajax({url:_pagSeguroSettings.ajax_transparente,method:"POST",data:t}).done(function(e){console.log(e),PagSeguroDirectPayment.setSessionId(e),getBrand(r,n)}).fail(function(e){console.log(e),errorPayment(r,n,_pagSeguroSettings.error_session)}).always(function(){})},getBrand=function(t,r){PagSeguroDirectPayment.getBrand({cardBin:e("input[name=cardNumber]").val().replace(/ /g,""),success:function(n){e("input[name=brandName]").val(n.brand.name),getInstallments(n.brand.name,t,r);var a=e("#"+n.brand.name).attr("src");e("#img_brand").html('<img src="'+a+'" alt="'+n.brand.name+'"/>')},error:function(n){e("#img_brand").html(""),errorPayment(t,r,_pagSeguroSettings.error_card_number)},complete:function(e){}})},getInstallments=function(t,r,n){var a=" "+_pagSeguroSettings.interest_true,o=" "+_pagSeguroSettings.interest_true,i=_pagSeguroSettings.currency_x+" ",s="";PagSeguroDirectPayment.getInstallments({amount:e("input[name=amount]").val(),maxInstallmentNoInterest:e("input[name=maxInstallment]").val(),brand:t,success:function(r){var n=r.installments[t];if(console.log(n),n.length>0){var c=[];e.each(n,function(e,t){var r=t.totalAmount.toFixed(2),n=t.installmentAmount.toFixed(2);s=0===e?t.quantity+i+r.replace(".",",")+a:1==t.interestFree?t.quantity+i+n.replace(".",",")+a:t.quantity+i+n.replace(".",",")+o,c.push({id:t.quantity+"|"+t.installmentAmount,text:s})}),e(".select-installments").select2({data:c})}},error:function(e){errorPayment(r,n,_pagSeguroSettings.error_method)},complete:function(e){}})},createCredCardToken=function(t,r){var n=e("input[name=cardCVV]").val(),a=e("#cardExpiryMonth option:selected").val(),o=e("#cardExpiryYear option:selected").val();PagSeguroDirectPayment.createCardToken({cardNumber:e("input[name=cardNumber]").val().replace(/ /g,""),brand:e("input[name=brandName]").val(),cvv:n,expirationMonth:a,expirationYear:o,success:function(n){e("input[name=cardToken]").val(n.card.token),createTransactionCard(t,r)},error:function(e){console.log(e.errors),errorPayment(t,r,_pagSeguroSettings.error_card_token)},complete:function(e){console.log(e)}})},createTransactionCard=function(t,r){var n=PagSeguroDirectPayment.getSenderHash();e("#senderHash").val(n);var a=e("#form-pagseguro").serialize();e.ajax({url:_pagSeguroSettings.ajax_transaction,method:"POST",data:a,beforeSend:startPreloaderPS(r)}).done(function(e){stopPreloaderPS(t,r),1==e.success?window.location=e.redirect:errorPayment(t,r,_pagSeguroSettings.text_error)}).fail(function(n){if(stopPreloaderPS(t,r),422==n.status){var a=e.parseJSON(n.responseText),o="";e.each(a,function(t,r){"errors"==t&&e.each(a[t],function(e,t){o+="<li>"+t+"</li>"})})}e("#return-payment").show(),e("#return-payment").html('<ul class="woocommerce-error">'+o+"</ul>"),setTimeout(function(){e("#return-payment").hide()},6e3)}).always(function(){stopPreloaderPS(t,r)})},e(".btn-payment-billet").click(function(){return setSessionBilletId(),!1}),setSessionBilletId=function(){var t=e("#form-pagseguro").serialize(),r=_pagSeguroSettings.btn_billet,n=_pagSeguroSettings.class_billet;e.ajax({url:_pagSeguroSettings.ajax_transparente,method:"POST",data:t,beforeSend:startPreloaderPS(n)}).done(function(e){PagSeguroDirectPayment.setSessionId(e),paymentBillet(r,n)}).fail(function(){errorPayment(r,n,_pagSeguroSettings.error_session)}).always(function(){})},paymentBillet=function(t,r){var n=PagSeguroDirectPayment.getSenderHash();e("#senderHash").val(n);var a=e("#form-pagseguro").serialize();e.ajax({url:_pagSeguroSettings.ajax_billet,method:"POST",data:a}).done(function(e){1==e.success?window.location=e.redirect:errorPayment(t,r,_pagSeguroSettings.text_error)}).fail(function(){errorPayment(t,r,_pagSeguroSettings.text_error)}).always(function(){stopPreloaderPS(t,r)})},errorPayment=function(t,r,n){stopPreloaderPS(t,r),e("#return-payment").show(),e("#return-payment").html('<ul class="woocommerce-error"><li>'+n+"</li></ul>"),setTimeout(function(){e("#return-payment").hide()},6e3)},startPreloaderPS=function(t){e(t).attr("disabled",!0).addClass(_pagSeguroSettings.class_loading).text(_pagSeguroSettings.text_loading)},stopPreloaderPS=function(t,r){e(r).attr("disabled",!1).removeClass(_pagSeguroSettings.class_loading).text(t)},getPaymentMethods=function(){startPreloaderPS(),PagSeguroDirectPayment.getPaymentMethods({success:function(t){console.log(t),0==t.error&&e.each(t.paymentMethods,function(t,r){e(".payment-methods").append(t+"<br>")})},error:function(e){console.log(e),stopPreloaderPS()},complete:function(e){console.log(e)}})}}(window.jQuery);
