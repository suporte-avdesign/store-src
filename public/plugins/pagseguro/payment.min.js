!function(e){var t;e(".btn-payment-card").click(function(){if(0==validateCard()){var e=_pagSeguroSettings.btn_card,t=_pagSeguroSettings.class_card;createCredCardToken(e,t)}return!1});e("#cardNumber").keyup(function(){clearTimeout(t),e("#cardNumber").val&&(t=setTimeout(setSessionCreditId,5e3))}),setSessionCreditId=function(t,a){var n=e("#form-pagseguro").serialize();e.ajax({url:_pagSeguroSettings.ajax_transparente,method:"POST",data:n}).done(function(e){console.log(e),PagSeguroDirectPayment.setSessionId(e),getBrand()}).fail(function(){console.log(_pagSeguroSettings.text_error)}).always(function(){})},getBrand=function(){PagSeguroDirectPayment.getBrand({cardBin:e("input[name=cardNumber]").val().replace(/ /g,""),success:function(t){e("input[name=brandName]").val(t.brand.name),getInstallments(t.brand.name)},error:function(e){console.log(e)},complete:function(e){}})},getInstallments=function(t){var a="";PagSeguroDirectPayment.getInstallments({amount:e("input[name=amount]").val(),maxInstallmentNoInterest:e("input[name=maxInstallment]").val(),brand:t,success:function(n){var r=n.installments[t];if(console.log(r),r.length>0){var o="";e.each(r,function(e,t){a=0===e?t.quantity+"x de R$ "+t.totalAmount+" (sem juros)":1==t.interestFree?t.quantity+"x de R$ "+t.installmentAmount+" (sem juros)":t.quantity+"x de R$ "+t.installmentAmount+" (com juros)",o+='<option value="'+t.quantity+"|"+t.installmentAmount+'">'+a+"</option>"}),e("#label1").html("<span>Parcele em até "+r.length+"x</span>"),e("#installments").show(),e("#installments").html(o)}else e("#label1").html("<span>Não Parcelamos</span>"),e("#installments").hide()},error:function(e){contole.log(e)},complete:function(e){}})},createCredCardToken=function(t,a){var n=e("input[name=cardCVV]").val(),r=e("#cardExpiryMonth option:selected").val(),o=e("#cardExpiryYear option:selected").val();PagSeguroDirectPayment.createCardToken({cardNumber:e("input[name=cardNumber]").val().replace(/ /g,""),brand:e("input[name=brandName]").val(),cvv:n,expirationMonth:r,expirationYear:o,success:function(n){e("input[name=cardToken]").val(n.card.token),createTransactionCard(t,a)},error:function(e){console.log(e),stopPreloaderPS(t,a)},complete:function(e){}})},createTransactionCard=function(t,a){var n=PagSeguroDirectPayment.getSenderHash();e("#senderHash").val(n);var r=e("#form-pagseguro").serialize();e.ajax({url:_pagSeguroSettings.ajax_transaction,method:"POST",data:r,beforeSend:startPreloaderPS(a)}).done(function(t){e("#return-payment").html("Seu pagamento foi realizado com sucesso! Código da Transação: "+t)}).fail(function(e){console.log(e.responseJSON.message),stopPreloaderPS(t,a)}).always(function(){})},validateCard=function(){var t=0,a="",n=e("input[name=cardNumber]").val(),r=e("input[name=cardName]").val(),o=e("input[name=cardCVV]").val();return n.length<19&&(t=1,e("input[name=cardNumber]").css("border","red solid 1px"),a="<li>"+_pagSeguroSettings.required_number+"</li>"),r.length<6&&(t=1,e("input[name=cardName]").css("border","red solid 1px"),a+="<li>"+_pagSeguroSettings.required_name+"</li>"),o.length<3&&(t=1,e("input[name=cardCVV]").css("border","red solid 1px"),a+="<li>"+_pagSeguroSettings.required_cvv+"</li>"),0==t?(e("input[name=cardNumber]").css("border","rgba(136, 135, 135, 0.25) solid 1px"),e("input[name=cardName]").css("border","rgba(136, 135, 135, 0.25) solid 1px"),e("input[name=cardCVV]").css("border","rgba(136, 135, 135, 0.25) solid 1px")):(e("#return-payment").show(),e("#return-payment").html('<ul class="woocommerce-error" role="alert">'+a+"</ul>"),setTimeout(function(){e("#return-payment").hide()},5e3)),t},e(".btn-payment-billet").click(function(){return setSessionBilletId(),!1}),setSessionBilletId=function(){var t=e("#form-pagseguro").serialize(),a=_pagSeguroSettings.btn_billet,n=_pagSeguroSettings.class_billet;e.ajax({url:_pagSeguroSettings.ajax_transparente,method:"POST",data:t,beforeSend:startPreloaderPS(n)}).done(function(e){PagSeguroDirectPayment.setSessionId(e),paymentBillet(a,n)}).fail(function(){stopPreloaderPS(a,n)}).always(function(){})},paymentBillet=function(t,a){var n=PagSeguroDirectPayment.getSenderHash();e("#senderHash").val(n);var r=e("#form-pagseguro").serialize();e.ajax({url:_pagSeguroSettings.ajax_billet,method:"POST",data:r}).done(function(e){e.success&&(window.location=e.redirect)}).fail(function(){console.log(_pagSeguroSettings.text_error),stopPreloaderPS(t,a)}).always(function(){stopPreloaderPS(t,a)})},startPreloaderPS=function(t){e(t).attr("disabled",!0).addClass(_pagSeguroSettings.class_loading).text(_pagSeguroSettings.text_loading)},stopPreloaderPS=function(t,a){e(a).attr("disabled",!1).removeClass(_pagSeguroSettings.class_loading).text(t)},getPaymentMethods=function(){startPreloaderPS(),PagSeguroDirectPayment.getPaymentMethods({success:function(t){console.log(t),0==t.error&&e.each(t.paymentMethods,function(t,a){e(".payment-methods").append(t+"<br>")})},error:function(e){console.log(e),stopPreloaderPS()},complete:function(e){console.log(e)}})}}(window.jQuery);
